@model Hatsukoi.Models.ViewModels.Seller.InfoSettingViewModel
@{
    ViewData["Title"] = "Home Page";
    Layout = "~/Views/Shared/_Layout_Back.cshtml";
}



<div class="all-space-seller">
    <div class="container my-container my-3" id="sellerInfoApp" v-cloak>
        <h4 class="fw-bolder py-4 fs-2">基本設定</h4>
        <div class="row py-3 mb-4 pb-5 border-bottom">
            <div class="col-12 col-md-3 mb-3">
                <p class="m-0 fs-3">設計館資訊</p>
            </div>
            <div class="col-12 col-md-9">
                <div class="my-white-text-space p-3 mb-4">
                    <p class="my-2 fw-bolder">設計館網址與帳號</p>
                    <p class="my-2 text-primary mb-5"><a class="text-primary" href="/Product/Shop/@Model.SellerId">https://getbootstrap.com/docs/4.1/components/buttons/</a></p>
                    <p class="my-2 fw-bolder">設計館所在地</p>
                    <p class="my-2 mb-5">@Model.City</p>
                    <p class="my-2 fw-bolder">使用幣別</p>
                    <p class="my-2 mb-5">新台幣 (TWD) NT$</p>
                    <p class="my-2 fw-bolder">其他語言</p>
                    <p class="my-2 mb-5">Hatsukoi 透過 Google 提供自動翻譯服務，協助顯示其他語言內容，讓你的品牌與商品被更多人看見，然而，為降低 Google 自動翻譯服務產生的相關風險，我們更鼓勵設計師自行填寫其他語言內容。</p>
                </div>
                <div class="my-white-text-space p-3">
                    <p class="my-2 fw-bolder">開館合約書</p>
                    <p class="my-2 text-primary mb-5">查看電子合約</p>
                    <p class="my-2 mb-5">
                    <p class="my-2 fw-bolder">立合約書人</p>
                    <p class="my-2">設計師姓名: @Model.ApplyName</p>
                    <p class="my-2">身分證字號: @Model.IdNumber</p>
                    <p class="my-2">連絡電話:  @Model.ApplyPhone</p>
                    <p class="my-2">登記地址: @Model.Address</p>
                    <p class="my-2 mb-5">Email(合約認證用): @Model.Email</p>
                    <p class="my-2 mb-5">如需更新合約書立書人 或 欲在 Hatsukoi 停止販售商品請來信至 <span class="text-primary">hatsukoi168@gmail.com</span> 。</p>
                </div>
            </div>
        </div>
        <h4 class="fw-bolder py-4 fs-2">基本資料</h4>
        <div class="row py-3 mb-4 pb-5 border-bottom">
            <div class="col-12 col-md-3 mb-3">
                <p class="m-0 fs-3">帳號資訊</p>
            </div>
            <div class="col-12 col-md-9">
                <div class="p-3 mb-4">
                    <div id="ApplyName" class="d-none">@Model.ApplyName</div>
                    <p class="my-2 fw-bolder text-small">真實姓名<sup class="text-danger">*</sup></p>
                    <input class="my-2 p-2 w-75" type="text" v-model="name">
                    <span class="p-2 my-0 text-danger text-small d-block">{{ applyNameWarn }}</span>
                    <span class="p-2 my-0 text-gray text-small mb-5 d-block">請填寫與證件相符的姓名，方便商品運送時聯繫與核對</span>
                    <div id="ApplicantEnglishName" class="d-none">@Model.ApplicantEnglishName</div>
                    <p class="my-2 fw-bolder text-small">英文姓名</p>
                    <input class="my-2 mb-5 p-2 w-75" type="text" v-model="english">
                    <span class="p-2 my-0 text-danger text-small d-block">{{ applyEGNameWarn }}</span>
                    <div id="ApplyPhone" class="d-none">@Model.ApplyPhone</div>
                    <p class="my-2 fw-bolder text-small">手機號碼<sup class="text-danger">*</sup></p>
                    <input class="my-2 p-2 w-75" type="text" v-model="phone">
                    <span class="p-2 my-0 text-danger text-small d-block">{{ phoneWarn }}</span>
                    <span class="p-2 my-0 text-gray text-small mb-5 d-block">請輸入你的手機號碼，商品寄送過程有問題時，方便與你聯繫</span>
                </div>
            </div>
        </div>
        <div class="row py-3 mb-4 pb-5 border-bottom">
            <div class="col-12 col-md-3 mb-3">
                <p class="m-0 fs-3">常用地址</p>
                <p class="my-2 lh-lg">請填寫最常處理出貨、退貨的地址。出貨時系統會在列印標籤時自動加入，退貨時系統會在退款核准申請時通知買家把商品寄到這裡。</p>
            </div>
            <div class="col-12 col-md-9">
                <div class="p-3 mb-4">
                    <div id="City" class="d-none">@Model.City</div>
                    <p class="my-2 fw-bolder text-small">國家/地區<sup class="text-danger">*</sup></p>
                    <input class="my-2 mb-5 p-2 w-75" type="text" v-model="city">
                    <span class="p-2 my-0 text-danger text-small d-block">{{ cityWarn }}</span>
                    <div id="Address" class="d-none">@Model.Address</div>
                    <p class="my-2 fw-bolder text-small">地址<sup class="text-danger">*</sup></p>
                    <input class="my-2 mb-5 p-2 w-75" type="text" v-model="address">
                    <span class="p-2 my-0 text-danger text-small d-block">{{ addressWarn }}</span>
                    <div id="PostalCode" class="d-none">@Model.PostalCode</div>
                    <p class="my-2 fw-bolder text-small">郵遞區號<sup class="text-danger">*</sup></p>
                    <input class="my-2 p-2 w-75" type="text" v-model="postalCode">
                    <span class="p-2 my-0 text-danger text-small d-block">{{ postalCodeWarn }}</span>
                    <span class="p-2 my-0 text-gray text-small d-block mb-5">請輸入正確的郵遞區號</span>
                    @*<div class="warn-area-english p-2 fw-bolder text-center w-75 my-3">以下地址請用英文填寫!</div>
                    <p class="my-2 fw-bolder text-small">Address line<sup class="text-danger">*</sup></p>
                    <input class="my-2 mb-5 p-2 w-75" type="text" value="">
                    <p class="my-2 fw-bolder text-small">Country/city<sup class="text-danger">*</sup></p>
                    <input class="my-2 mb-5 p-2 w-75" type="text" value="">
                    <p class="my-2 fw-bolder text-small">Postal code<sup class="text-danger">*</sup></p>
                    <input class="my-2 p-2 w-75" type="text" value="">*@
                </div>
            </div>
            <div class="d-flex justify-content-center">
                <button class="btn my-btn" v-bind:disabled="disa" v-on:click="editInfo">更新</button>
            </div>
        </div>
        <div class="row py-3 mb-4 pb-5 border-bottom">
            <div class="col-12 col-md-3 mb-3">
                <p class="m-0 fs-3">信箱設定</p>
                <p class="my-2 lh-lg">系統會發送品運送通知、站方活動消息、會員動態通知、設計館其他通知道你的信箱。</p>
            </div>
            <div class="col-12 col-md-9">
                <div class="p-3 mb-4">
                    <div id="Email" class="d-none">@Model.Email</div>
                    <p class="my-2 fw-bolder text-small">主要信箱<sup class="text-danger">*</sup></p>
                    <input class="my-2 mb-5 p-2 w-75" type="text" v-model="email" disabled>
                    <div id="SecondEmail" class="d-none">@Model.SecondEmail</div>
                    <p class="my-2 fw-bolder text-small">聯絡信箱</p>
                    <input class="my-2 p-2 w-75" type="text" v-model="secondEmail">
                </div>
            </div>
            <span class="p-2 my-0 text-danger text-small d-block">{{ checkWarn }}</span>
            <div class="d-flex justify-content-center">
                <button class="btn my-btn" v-bind:disabled="emailDisa" v-on:click="editEmail">{{ countEmail }}</button>
            </div>
            <div class="fw-bolder text-big my-2 text-danger">更變電子郵件時會寄驗證信到您新設定的Email以此來確定您的身分。</div>
        </div>
    </div>
</div>
<script>
    let ApplyName = document.querySelector('#ApplyName');
    let ApplicantEnglishName = document.querySelector('#ApplicantEnglishName');
    let ApplyPhone = document.querySelector('#ApplyPhone');
    let City = document.querySelector('#City');
    let Address = document.querySelector('#Address');
    let PostalCode = document.querySelector('#PostalCode');
    let Email = document.querySelector('#Email');
    let SecondEmail = document.querySelector('#SecondEmail');
    const sellerInfoApp = new Vue({
        el: '#sellerInfoApp',
        data: {
            name: ApplyName.innerText,
            english: ApplicantEnglishName.innerText,
            phone: ApplyPhone.innerText,
            city: City.innerText,
            address: Address.innerText,
            postalCode: PostalCode.innerText,
            email: Email.innerText,
            secondEmail: SecondEmail.innerText,
            applyNameWarn: '',
            applyEGNameWarn: '',
            phoneWarn: '',
            cityWarn: '',
            addressWarn: '',
            postalCodeWarn: '',
            disa: true,
            emailDisa: true,
            emailWarn: '',
            emailSecWarn: '',
            checkWarn: '',
            countEmail: '更新Email'
        },
        methods: {
            editInfo() {
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'bottom-end',
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })

                Toast.fire({
                    icon: 'success',
                    title: '資訊更新中'
                })
                let th = this
                th.disa = true
                $.ajax({
                    url: '/api/Seller/EditInfo',
                    type: 'POST',
                    contentType: "application/json",
                    data: JSON.stringify({
                        ApplyName: th.name,
                        ApplicantEnglishName: th.english,
                        ApplyPhone: th.phone,
                        City: th.city,
                        Address: th.address,
                        PostalCode: th.postalCode
                    }),
                    success: function (output) {
                        th.disa = false
                        window.location.href = "/Seller/InfoSetting"
                    }
                });
            },
            editEmail() {
                let th = this
                this.emailDisa = true
                let edEmail = this.secondEmail
                $.ajax({
                    url: '/api/Seller/EditEmailInfo',
                    type: 'POST',
                    contentType: "application/json",
                    data: JSON.stringify({
                        InputEmail: edEmail
                    }),
                    success: function (output) {
                        if (output.result.hasEmail != '') {
                            th.checkWarn = output.result.hasEmail
                        }
                        else {
                            th.checkWarn = ''
                            let count = 60;
                            let timerId = setInterval(function () {
                                th.countEmail = count
                                count = count - 1;
                                if (count < 0) {
                                    clearInterval(timerId);
                                    th.countEmail = '重新寄送驗證信'
                                    th.emailDisa = false;
                                }
                            }, 1000)
                        }
                    }
                });
            }
        },
        watch: {
            name: function () {
                let r = /^[\u4E00-\u9FFF]+$/
                if (!r.test(this.name)) {
                    this.applyNameWarn = '名稱不得為空，並且只能為中文。'
                    this.disa = true
                }
                else {
                    this.applyNameWarn = ''
                    this.disa = false
                }
            },
            english: function () {
                let r = /^[A-Za-z]+$/
                if (!r.test(this.english)) {
                    this.applyEGNameWarn = '名稱不得為空，並且只能為英文。'
                    this.disa = true
                }
                else {
                    this.applyEGNameWarn = ''
                    this.disa = false
                }
            },
            phone: function () {
                let r = /^\d{10}$/
                if (!r.test(this.phone)) {
                    this.phoneWarn = '電話不得為空，並且只能為10碼數字。'
                    this.disa = true
                }
                else {
                    this.phoneWarn = ''
                    this.disa = false
                }
            },
            city: function () {
                let r = /^[\u4E00-\u9FFFA-Za-z]+$/
                if (!r.test(this.city)) {
                    this.cityWarn = '地區不得為空，並且只能為英文或中文。'
                    this.disa = true
                }
                else {
                    this.cityWarn = ''
                    this.disa = false
                }
            },
            address: function () {
                let r = /^[\u4E00-\u9FFFA-Za-z]+$/
                if (!r.test(this.address)) {
                    this.addressWarn = '地址不得為空，並且只能為英文或中文。'
                    this.disa = true
                }
                else {
                    this.addressWarn = ''
                    this.disa = false
                }
            },
            postalCode: function () {
                let r = /^\d{5,6}$/
                if (!r.test(this.postalCode)) {
                    this.postalCodeWarn = '郵遞區號不得為空，並且只能為5或6碼數字。'
                    this.disa = true
                }
                else {
                    this.postalCodeWarn = ''
                    this.disa = false
                }
            },
            email: function () {
                let r = /^\w+([-+.]\w+)*@@\w+([-.]\w+)*\.\w+([-.]\w+)*$/
                if (!r.test(this.email)) {
                    this.emailWarn = 'email格式錯誤。'
                    this.emailDisa = true
                }
                else {
                    this.emailWarn = ''
                    this.emailDisa = false
                }
            },
            secondEmail: function () {
                let r = /^\w+([-+.]\w+)*@@\w+([-.]\w+)*\.\w+([-.]\w+)*$/
                if (!r.test(this.secondEmail)) {
                    this.emailSecWarn = 'email格式錯誤。'
                    this.emailDisa = true
                }
                else {
                    this.emailSecWarn = ''
                    this.emailDisa = false
                }
            },
        }
    })
</script>
@section topCSS{
    <link href="~/css/seller/sellerinfo.css" rel="stylesheet" />
}