@model Hatsukoi.Models.ViewModels.Seller.IntroductionViewModel
@{
    ViewData["Title"] = "Home Page";
    Layout = "~/Views/Shared/_Layout_Back.cshtml";
}
<div class="all-space-seller">
    <div class="container my-container my-3" id="introApp" v-cloak>
        <h4 class="fw-bolder py-4 fs-2">品牌介紹</h4>
        <p class="m-0 w-75 mb-3">能夠吸引目光的設計館招牌與清楚辨認的設計館圖示，是買家對品牌的第一印象。而品牌故事也同樣重要，不但讓買家進一步了解創作的開始與過程，也建立品牌本身的質感和價值</p>
        <div class="row py-3 mb-4 pb-5 border-bottom">
            <div class="col-12 col-md-3 mb-3">
                <p class="m-0 fs-3">設計館圖示</p>
                <p class="my-2 lh-lg">設計館圖示是用來辨認品牌的視覺象徵，將會是設計館在網站內主要的視覺代表，建議以品牌 Logo 或是品牌具代表性的圖像作為設計館圖示。</p>
            </div>
            <div class="col-12 col-md-9">
                <div class="p-3 mb-4 pt-0">
                    <div class="warn-area-english p-2 fw-bolder my-3 ps-4">
                        <p class="my-1 text-danger">請注意</p>
                        <p class="my-1 fw-bolder">設計館圖示請勿加上站外網址、Email 或手機等任何含廣告意涵的連絡資訊</p>
                    </div>
                    <h2 class="fw-bolder fs-2">Icon圖片</h2>
                    <div class="d-flex justify-content-between pt-3 align-items-center">
                        <div id="pic1" class="d-none">@Model.Icon</div>
                        <div class="update-pic m-2">
                            <img v-bind:src="icon" />
                        </div>
                        <label for="update-pic" class="btn my-btn-mark p-2 px-4 text-small">選擇照片</label>
                        <input type="file" class="form-control d-none" id="update-pic" accept="image/*" v-on:change="changeImg1">
                        <p class="w-25">Icon 尺寸以600 x 600 px 的 JPG 或 PNG 格式圖片為佳。</p>
                    </div>
                    <h2 class="fw-bolder fs-2">Logo圖片</h2>
                    <div class="d-flex justify-content-between pt-3 align-items-center">
                        <div id="pic2" class="d-none">@Model.Logo</div>
                        <div class="update-banner m-2">
                            <img v-bind:src="logo" />
                        </div>
                        <label for="update-pic1" class="btn my-btn-mark p-2 px-4 text-small">選擇照片</label>
                        <input type="file" class="form-control d-none" id="update-pic1" accept="image/*" v-on:change="changeImg2">
                        <p class="w-25">Logo 尺寸以1000 x 300 px 的 JPG 或 PNG 格式圖片為佳。</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row py-3 mb-4 pb-5 border-bottom">
            <div class="col-12 col-md-3 mb-3">
                <p class="m-0 fs-3">設計館招牌</p>
            </div>
            <div class="col-12 col-md-9">
                <div class="p-3 mb-4 pt-0">
                    <div class="warn-area-english p-2 fw-bolder my-3 ps-4">
                        <p class="my-1 text-danger">請注意</p>
                        <p class="my-1 fw-bolder">設計館圖示請勿加上站外網址、Email 或手機等任何含廣告意涵的連絡資訊</p>
                    </div>
                    <h2 class="fw-bolder fs-2">方形招牌</h2>
                    <div class="d-flex justify-content-between pt-3 align-items-center">
                        <div id="pic3" class="d-none">@Model.ShopBannerSquare</div>
                        <div class="update-pic m-2">
                            <img v-bind:src="square" />
                        </div>
                        <label for="update-pic2" class="btn my-btn-mark p-2 px-4 text-small">選擇照片</label>
                        <input type="file" class="form-control d-none" id="update-pic2" accept="image/*" v-on:change="changeImg3">
                        <p class="w-25">方形招牌尺寸以600 x 600 px 的 JPG 或 PNG 格式圖片為佳。</p>
                    </div>
                    <h2 class="fw-bolder fs-2">矩形招牌</h2>
                    <div class="d-flex justify-content-between pt-3 align-items-center">
                        <div id="pic4" class="d-none">@Model.ShopBannerRect</div>
                        <div class="update-banner m-2">
                            <img v-bind:src="rect" />
                        </div>
                        <label for="update-pic3" class="btn my-btn-mark p-2 px-4 text-small">選擇照片</label>
                        <input type="file" class="form-control d-none" id="update-pic3" accept="image/*" v-on:change="changeImg4">
                        <p class="w-25">矩形招牌尺寸以1000 x 300 px 的 JPG 或 PNG 格式圖片為佳。</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row py-3 mb-4 pb-5 border-bottom">
            <div class="col-12 col-md-3 mb-3">
                <p class="m-0 fs-3">設計館介紹</p>
            </div>
            <div class="col-12 col-md-9">
                <div class="p-3 mb-4">
                    <p class="my-2 fw-bolder text-small">設計館名稱<sup class="text-danger">*</sup></p>
                    <div id="ShopName" class="d-none">@Model.ShopName</div>
                    <input class="my-2 mb-5 p-2 w-75" type="text" v-model="MyshopName">
                    <span class="d-block my-2 text-small text-danger">{{ applyNameWarn }}</span>
                    <div class="warn-area-english p-2 fw-bolder my-3 ps-4">
                        <p class="my-1 text-danger">請注意</p>
                        <p class="my-1 fw-bolder">設計館故事請勿加上站外網址、Email 或手機等任何含廣告意涵的連絡資訊</p>
                    </div>
                    <p class="my-2 fw-bolder text-small">設計館故事<sup class="text-danger">*</sup></p>
                    <div id="Introduction" class="d-none">@Model.Introduction</div>
                    @*<textarea class="my-2 mb-5 p-2 w-75" id="story-textarea" rows="3">{{ story }}</textarea>*@
                    <div class="form-group col-md-12" id="SellerEditer">
                        <div id="editor">
                            @Html.Raw(Model.Introduction)
                        </div>
                    </div>
                    <span class="d-block my-2 text-small text-danger">{{ checkWarn }}</span>
                </div>
            </div>

            <span class="d-block my-2 text-small text-danger">{{ nameWarn }}</span>
            <div class="d-flex justify-content-center">
                <button class="btn my-btn" v-bind:disabled="disa" v-on:click="editInfo">更新</button>
            </div>
        </div>
    </div>

  
</div>
<script>
    let textEditor
    let pic1 = document.querySelector('#pic1');
    let pic2 = document.querySelector('#pic2');
    let pic3 = document.querySelector('#pic3');
    let pic4 = document.querySelector('#pic4');
    let ShopName = document.querySelector('#ShopName');
    let Introduction = document.querySelector('#Introduction');
    const contentElement = document.querySelector('#content');
    const introApp = new Vue({
        el: '#introApp',
        data: {
            icon: pic1.innerText,
            logo: pic2.innerText,
            square: pic3.innerText,
            rect: pic4.innerText,
            img1: '',
            img2: '',
            img3: '',
            img4: '',
            MyshopName: ShopName.innerText,
            story: Introduction.innerText,
            disa: false,
            applyNameWarn: '',
            checkWarn: '',
            nameWarn: ''
        },
        methods: {
            changeImg1: function (event) {
                let input = event.target;
                if (input.files) {
                    let reader = new FileReader();
                    reader.onload = (e) => {
                        this.icon = e.target.result;
                    }
                    this.img1 = input.files[0];
                    reader.readAsDataURL(input.files[0]);
                }
            },
            changeImg2: function (event) {
                let input = event.target;
                if (input.files) {
                    let reader = new FileReader();
                    reader.onload = (e) => {
                        this.logo = e.target.result;
                    }
                    this.img2 = input.files[0];
                    reader.readAsDataURL(input.files[0]);
                }
            },
            changeImg3: function (event) {
                let input = event.target;
                if (input.files) {
                    let reader = new FileReader();
                    reader.onload = (e) => {
                        this.square = e.target.result;
                    }
                    this.img3 = input.files[0];
                    reader.readAsDataURL(input.files[0]);
                }
            },
            changeImg4: function (event) {
                let input = event.target;
                if (input.files) {
                    let reader = new FileReader();
                    reader.onload = (e) => {
                        this.rect = e.target.result;
                    }
                    this.img4 = input.files[0];
                    reader.readAsDataURL(input.files[0]);
                }
            },
            editInfo() {
                if (this.story == '') {
                    this.checkWarn = '商店故事不可為空值'
                }
                else {
                    const Toast = Swal.mixin({
                        toast: true,
                        position: 'bottom-end',
                        showConfirmButton: false,
                        timer: 3000,
                        timerProgressBar: true,
                        didOpen: (toast) => {
                            toast.addEventListener('mouseenter', Swal.stopTimer)
                            toast.addEventListener('mouseleave', Swal.resumeTimer)
                        }
                    })

                    Toast.fire({
                        icon: 'success',
                        title: '資訊更新中'
                    })
                    this.checkWarn = ''
                    let th = this
                    th.disa = true
                    $.ajax({
                        url: '/api/Seller/EditIntroduction',
                        type: 'POST',
                        contentType: "application/json",
                        data: JSON.stringify({
                            Introduction: textEditor.innerHTML,
                            Logo: th.logo,
                            ShopBannerSquare: th.square,
                            Icon: th.icon,
                            ShopBannerRect: th.rect,
                            ShopName: th.MyshopName
                        }),
                        success: function (output) {
                            if (output.result.hasShopName != "") {
                                th.nameWarn = output.result.hasShopName
                                th.disa = false
                            }
                            else{
                                th.disa = false
                                window.location.href = "/Seller/Introduction"
                            }
                        }
                    });
                }
            },
        },
        watch: {
            MyshopName: function () {
                let r = /^[\u4E00-\u9FFFA-Za-z]+$/
                if (!r.test(this.MyshopName)) {
                    this.applyNameWarn = '名稱不得為空，並且只能為英文或中文。'
                    this.disa = true
                }
                else {
                    this.applyNameWarn = ''
                    this.disa = false
                }
            },
            story: function () {
                let r = /^.+$/
                if (!r.test(this.story)) {
                    this.checkWarn = '名稱不得為空，並且只能為英文或中文。'
                    this.disa = true
                }
                else {
                    this.checkWarn = ''
                    this.disa = false
                }
            }
        }
    })
    ClassicEditor
        .create(document.querySelector('#editor'), {
            toolbar: {
                items: [
                    'heading', '|', 'bold', 'italic', 'link', 'bulletedList', 'numberedList',
                    '|', 'alignment', 'outdent', 'indent', '|', 'fontSize', 'fontColor',
                    '|', 'imageUpload', 'blockQuote', 'insertTable', 'mediaEmbed',
                    'undo', 'redo'
                ]
            },
            image: {
                toolbar: [
                    'imageTextAlternative', 'imageStyle:inline',
                    'imageStyle:block', 'imageStyle:side'
                ]
            },
            table: {
                contentToolbar: [
                    'tableColumn', 'tableRow', 'mergeTableCells'
                ]
            },
            licenseKey: '',
            heading: {
                // 設定 Heading 內的樣式，可新增多個
                options: [
                    {
                        model: 'paragraph',
                        title: 'Paragraph',
                        class: 'ck-heading_paragraph'
                    },
                    {
                        model: 'heading1',
                        view: 'h2',
                        title: 'Heading 1',
                        class: 'ck-heading_heading1'
                    },
                    {
                        model: 'heading2',
                        view: 'h3',
                        title: 'Heading 2',
                        class: 'ck-heading_heading2'
                    }
                ]
            },
        })
        .then(editor => {
            window.editor = editor;
            window.editorContent = editor.getData(); // 將 editorContent 定義在全域範圍內
            console.log(window.editorContent);
            contentElement.innerHTML = editorData
        })
        .catch(error => {
        });

    window.onload = function(){
        textEditor = document.querySelector('.ck-content')
        textEditor.innerHTML = Introduction.innerText;
    }
</script>

@section topCSS{
    <link href="~/css/product/create.css" rel="stylesheet" />
    <link href="~/css/product/sort.css" rel="stylesheet" />
    <link href="~/css/seller/sellerinfo.css" rel="stylesheet" />
    }
@*@section endJS{
    <script src="~/js/product/neweditor.js"></script>
    }*@